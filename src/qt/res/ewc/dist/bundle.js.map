{"version":3,"sources":["webpack:///webpack/bootstrap d8ccab745f9eaee84c15?e5df***","webpack:///./webcrypto.js?5110***"],"names":["document","addEventListener","window","crypto","subtle","alert","myKeys","username","publicKey","privateKey","theirpPublicKey","theirUsername","encryptedSessionKey","message","convertPassphraseToKey","passphraseString","saltBase64","console","log","iterations","saltBytes","base64ToByteArray","passphraseBytes","stringToByteArray","importKey","name","then","baseKey","deriveKey","salt","hash","length","catch","err","decryptPrivateKey","encryptedPrivaeKey","passphrase","base64Salt","localStorage","getItem","debug","key","ciphertextBytes","ivBase64","iv","encrypt","plaintextBuf","plaintextBytes","Uint8Array","base64plaintext","byteArrayToBase64","encryptPrivateKey","getRandomValues","setItem","ciphertextBuf","base64Ciphertext","createKeyPair","generateKey","modulusLength","publicExponent","keyPair","exportKey","spkiBuffer","spkiBytes","spkiString","pkcs8Buffer","pkcs8Bytes","pkcs8String","inputPlaintext","sessionKey","input","encryptReadFile","ivBytes","TextEncoder","encode","ciphertextBuffer","toBeSent","sessionKeyBuffer","encryptedSessionKeyBuffer","encryptedSessionKeyBytes","encryptedSessionKeyBase64","sessionkey","channel","RTCMultiSession","send","JSON","stringify","decrypt","parse","ciphertext","plaintextBuffer","plaintextDecypted","String","fromCharCode","apply","writeToChatLog"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d8ccab745f9eaee84c15\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d8ccab745f9eaee84c15\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d8ccab745f9eaee84c15\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d8ccab745f9eaee84c15\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d8ccab745f9eaee84c15","document.addEventListener(\"DOMContentLoaded\", function () {\n    \"use strict\";\n    if (!window.crypto || !window.crypto.subtle) {\n        alert(\"Your current browser does not support the Web Cryptography API! This page will not work.\");\n        return;\n    }\n});\n\nvar myKeys;\nvar username;\nvar publicKey;\nvar privateKey;\nvar theirpPublicKey;\nvar theirUsername;\nvar encryptedSessionKey;\nvar message;\n\nfunction convertPassphraseToKey(passphraseString, saltBase64) {\n    // Loading\n    console.log(\"Generating key...\");\n\n    var iterations = 1000000;   // Longer is slower... hence stronger\n    var saltBytes = base64ToByteArray(saltBase64); //\n    var passphraseBytes = stringToByteArray(passphraseString);\n\n    // deriveKey needs to be given a base key. This is just a\n    // CryptoKey that represents the starting passphrase.\n    return window.crypto.subtle.importKey(\n        \"raw\", passphraseBytes, {name: \"PBKDF2\"}, false, [\"deriveKey\"]\n    ).then(function (baseKey) {\n        return window.crypto.subtle.deriveKey(\n            // Firefox currently only supports SHA-1 with PBKDF2\n            {name: \"PBKDF2\", salt: saltBytes, iterations: iterations, hash: \"SHA-1\"},\n            baseKey,\n            {name: \"AES-CBC\", length: 256}, // Resulting key type we want\n            true,  // exportable\n            [\"encrypt\", \"decrypt\"]\n        );\n    }).catch(function (err) {\n        alert(\"Could not generate a key from passphrase '\" + passphraseString + \"': \" + err.message);\n    });\n}\n\nfunction decryptPrivateKey(encryptedPrivaeKey, passphrase) {\n    var base64Salt = localStorage.getItem(\"salt\");\n    var salt = base64ToByteArray(base64Salt);\n\n\n    console.debug(\"Cipher[1] :\" + encryptedPrivaeKey);\n\n\n    convertPassphraseToKey(passphrase, base64Salt).then(function (key) {\n\n        console.log('Decrypting private key...');\n        // console.debug(aesKey);\n        var ciphertextBytes = base64ToByteArray(encryptedPrivaeKey);\n\n        /// CALL AES CBC ENCRYPT\n        var ivBase64 = (localStorage.getItem(\"keyIV\"));\n        var iv = base64ToByteArray(ivBase64);\n\n        window.crypto.subtle.encrypt(\n            {name: \"AES-CBC\", iv: iv},\n            key,\n            ciphertextBytes\n        ).then(function (plaintextBuf) {\n            // Encode ciphertext to base 64 and put in Ciphertext field\n            plaintextBytes = new Uint8Array(plaintextBuf);\n            base64plaintext = byteArrayToBase64(plaintextBytes);\n\n            /// SET GLOBAL VARIABLE AS PRIVATE KEY\n            privateKey = base64plaintext;\n\n            console.debug(\"Clear [1] :\" + privateKey);\n\n            console.log(\"Done: Decrypting of private key\")\n\n        }).catch(function (err) {\n            alert(\"Decryption error: \" + err.message);\n        });\n    });\n}\n\n\nfunction encryptPrivateKey(privateKey, passphrase) {\n\n    console.debug(\"Clear[0] :\" + privateKey);\n\n    var salt = window.crypto.getRandomValues(new Uint8Array(16));\n    var base64Salt = byteArrayToBase64(salt);\n\n    localStorage.setItem(\"salt\", base64Salt);\n\n    convertPassphraseToKey(passphrase, base64Salt).then(function (key) {\n\n        console.log('Encrypting private key...');\n        // console.debug(aesKey);\n        var plaintextBytes = base64ToByteArray(privateKey);\n\n        /// CALL AES CBC ENCRYPT\n        var iv = window.crypto.getRandomValues(new Uint8Array(16));\n        var ivBase64 = byteArrayToBase64(iv);\n        localStorage.setItem(\"keyIV\", ivBase64);\n\n        window.crypto.subtle.encrypt(\n            {name: \"AES-CBC\", iv: iv},\n            key,\n            plaintextBytes\n        ).then(function (ciphertextBuf) {\n            // Encode ciphertext to base 64 and put in Ciphertext field\n            ciphertextBytes = new Uint8Array(ciphertextBuf);\n            base64Ciphertext = byteArrayToBase64(ciphertextBytes);\n            localStorage.setItem(\"privateKey\", base64Ciphertext);\n\n            console.debug(\"Cipher[0] :\" + base64Ciphertext);\n\n            console.log(\"Done: Encrypting of private key\")\n\n        }).catch(function (err) {\n            alert(\"Encryption error: \" + err.message);\n        });\n    });\n}\n\n\nfunction createKeyPair(passphrase) {\n    window.crypto.subtle.generateKey(\n        {\n            name: \"RSASSA-PKCS1-v1_5\",\n            modulusLength: 2048,\n            publicExponent: new Uint8Array([1, 0, 1]), // 65537\n            hash: {name: \"SHA-256\"}\n        },\n        true,\n        [\"sign\", \"verify\"]\n    ).then(function (keyPair) {\n        myKeys = keyPair;\n        window.crypto.subtle.exportKey(\"spki\", keyPair.publicKey\n        ).then(function (spkiBuffer) {\n            var spkiBytes = new Uint8Array(spkiBuffer);\n            var spkiString = byteArrayToBase64(spkiBytes);\n            publicKey = spkiString;\n            localStorage.setItem(\"publicKey\", publicKey);\n        }).catch(function (err) {\n            alert(\"Could not export public key: \" + err.message);\n        });\n\n        window.crypto.subtle.exportKey(\"pkcs8\", keyPair.privateKey\n        ).then(function (pkcs8Buffer) {\n            var pkcs8Bytes = new Uint8Array(pkcs8Buffer);\n            var pkcs8String = byteArrayToBase64(pkcs8Bytes);\n            privateKey = pkcs8String;\n\n            encryptPrivateKey(privateKey, passphrase)\n\n        }).catch(function (err) {\n            alert(\"Could not export private key: \" + err.message);\n        });\n\n    }).catch(function (err) {\n        alert(\"Could not generate key pair: \" + err.message);\n    });\n}\n\nfunction encrypt(inputPlaintext) {\n\n    var spkiBytes = base64ToByteArray(theirpPublicKey);\n    // Start by getting the RSA public key for encrypting session key\n    window.crypto.subtle.importKey(\n        \"spki\",\n        spkiBytes,\n        {name: \"RSA-OAEP\", hash: \"SHA-256\"},\n        false,\n        [\"encrypt\"]\n    ).then(function (publicKey) {\n        // Now we need to create a random session key for encrypting\n        // the actual plaintext.\n        return window.crypto.subtle.generateKey(\n            {name: \"AES-CBC\", length: 256},\n            true,\n            [\"encrypt\", \"decrypt\"]\n        ).then(function (sessionKey) {\n            // We need to do two things with the session key:\n            //    Use it to encrypt the selected plaintext file\n            //    Encrypt the session key with the public key\n\n            // Part 1 - Read the file and encrypt it with the session key.\n            var input = inputPlaintext; //document.getElementById(\"plaintext\").value;\n            // console.debug(inputPlaintext);\n            encryptReadFile(input); // See definition below\n\n            function encryptReadFile(inputPlaintext) {\n                var ivBytes = window.crypto.getRandomValues(new Uint8Array(16));\n                var plaintextBytes = new TextEncoder(\"utf-8\").encode(inputPlaintext);\n                window.crypto.subtle.encrypt(\n                    {name: \"AES-CBC\", iv: ivBytes}, sessionKey, plaintextBytes\n                ).then(function (ciphertextBuffer) {\n                    // Build a Blob with the 16-byte IV followed by the ciphertext\n                    var toBeSent = [ivBytes, new Uint8Array(ciphertextBuffer)];\n                    message = {\"iv\": byteArrayToBase64(toBeSent[0]), \"ciphertext\": byteArrayToBase64(toBeSent[1])};\n                }).catch(function (err) {\n                    alert(\"Could not encrypt the plaintext: \" + err.message);\n                });\n            }\n\n            // Part 2 - encrypt the session key with the public key. This\n            //          requires exporting it first.\n            window.crypto.subtle.exportKey(\n                \"raw\", sessionKey\n            ).then(function (sessionKeyBuffer) {\n                // Encrypt the session key in the buffer, save the encrypted\n                // key in the keyBox element.\n                window.crypto.subtle.encrypt(\n                    {name: \"RSA-OAEP\"},\n                    publicKey, // from closure\n                    sessionKeyBuffer\n                ).then(function (encryptedSessionKeyBuffer) {\n                    var encryptedSessionKeyBytes = new Uint8Array(encryptedSessionKeyBuffer);\n                    var encryptedSessionKeyBase64 = byteArrayToBase64(encryptedSessionKeyBytes);\n                    encryptedSessionKey = encryptedSessionKeyBase64;\n                    message.sessionkey = encryptedSessionKey;\n                    var channel = new RTCMultiSession();\n                    channel.send({message: {\"type\": \"data\", \"value\": JSON.stringify(message)}})\n                }).catch(function (err) {\n                    alert(\"Could not encrypt session key.\");\n                });\n            }).catch(function (err) {\n                alert(\"Could not export random session key:\" + err.message);\n            });\n        }).catch(function (err) {\n            alert(\"Could not generate random session key: \" + err.message);\n        });\n    }).catch(function (err) {\n        alert(\"Could not import public key: \" + err.message);\n    });\n}\n\nfunction decrypt(message) {\n    var pkcs8Bytes = base64ToByteArray(privateKey);\n\n    console.log(\"decrypt\");\n    console.debug(privateKey);\n\n    // We need a CryptoKey object holding the private key to get started\n    window.crypto.subtle.importKey(\n        \"pkcs8\",\n        pkcs8Bytes,\n        {name: \"RSA-OAEP\", hash: \"SHA-256\"},\n        false,\n        [\"decrypt\"]\n    ).then(function (privateKey) {\n\n        // Now use the private key to decrypt the session key\n        //var keyBox = document.getElementById(\"sessionkey\");\n        message = JSON.parse(message);\n\n        // console.debug(message)\n\n        var encryptedSessionKeyBase64 = message.sessionkey;  //keyBox.value;\n        var encryptedSessionKeyBytes = base64ToByteArray(encryptedSessionKeyBase64);\n\n        window.crypto.subtle.decrypt(\n            {name: \"RSA-OAEP\"}, privateKey, encryptedSessionKeyBytes\n        ).then(function (sessionKeyBuffer) {\n\n            window.crypto.subtle.importKey(\n                // We can't use the session key until it is in a CryptoKey object\n                \"raw\", sessionKeyBuffer, {name: \"AES-CBC\", length: 256}, false, [\"decrypt\"]\n            ).then(function (sessionKey) {\n                // Finally, we can read and decrypt the ciphertext file\n                var ciphertextBytes = base64ToByteArray(message.ciphertext);\n                var ivBytes = base64ToByteArray(message.iv);\n                window.crypto.subtle.decrypt(\n                    {name: \"AES-CBC\", iv: ivBytes}, sessionKey, ciphertextBytes\n                ).then(function (plaintextBuffer) {\n\n                    var plaintextDecypted = String.fromCharCode.apply(null, new Uint8Array(plaintextBuffer));\n                    writeToChatLog(theirUsername + \": \" + plaintextDecypted, 'text-info')\n\n                }).catch(function (err) {\n                    alert(\"Could not decrypt the ciphertext: \" + err.message);\n                });\n            }).catch(function (err) {\n                alert(\"Error importing session key: \" + err.message);\n            });\n        }).catch(function (err) {\n            alert(\"Error decrypting session key: \" + err.message);\n        });\n    }).catch(function (err) {\n        alert(\"Could not import private key: \" + err.message)\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./webcrypto.js\n\n\n// WEBPACK FOOTER //\n// ./webcrypto.js\n\n\n// WEBPACK FOOTER //\n// ./webcrypto.js\n\n\n// WEBPACK FOOTER //\n// ./webcrypto.js\n\n\n// WEBPACK FOOTER //\n// ./webcrypto.js"],"sourceRoot":""}